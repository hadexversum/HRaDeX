<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="HRaDeX">
<title>Workflow description • HRaDeX</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Workflow description">
<meta property="og:description" content="HRaDeX">
<meta property="og:image" content="https://hadexversum.github.io/HRaDeX/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">HRaDeX</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gui_guide.html">How to use the apps?</a>
    <a class="dropdown-item" href="../articles/visualization.html">Visualization methods</a>
    <a class="dropdown-item" href="../articles/workflow.html">Workflow description</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Workflow description</h1>
            
      
      
      <div class="d-none name"><code>workflow.Rmd</code></div>
    </div>

    
    
<p>Article under development. This article covers in detail the
classification workflow, alongside the numerical transformations. For
the methods of visualization of results obtained using classification
workflow, see the article on Visualization methods:
<code><a href="../articles/visualization.html">vignette("visualization")</a></code>.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The baseline of the HDX-MS method is the investigation of the
exchange between hydrogen from the protein structure with deuterium from
the buffer in which the protein is suspended. The difference in mass
between hydrogen and deuterium is very close to 1 Da, so that we can
identify the mass uptake with the number of exchanged hydrogens.
Multiple time measurements allow us to see the exchange in time and
create an exchange curve of the process for each measured and identified
peptide (in a bottom-up approach).</p>
<p>The main challenge in HDX-MS is data analysis and interpretation.
Although different methods of analysis focus on numerical values, that
may be difficult to interpret, we wanted to propose a classification
method to simplify communication of the results. Moreover, we are
avoiding any data transformation, instead, propose a class label for
perfectly known and valid experimental curves.</p>
</div>
<div class="section level2">
<h2 id="classification-method">Classification method<a class="anchor" aria-label="anchor" href="#classification-method"></a>
</h2>
<p>This method aims to assign each peptide a specific combination of
exchange classes, consistent with experimental results. This allows us
to distinguish areas with different exchange patterns in the protein
sequence, and to describe the exchange process itself.</p>
<p>The class assignment is the final step of the classification process,
based on the literature description of the hydrogen-deuterium
phenomenon. The process has several steps, with multiple workflow
decisions under the experimenter’s control.</p>
<p>In the figure <em>x</em>, examples of experimental curves are
presented. Although it is easy to discriminate between the extreme cases
(described and defined in section <em>x</em>) - immediate exchange (red)
and none-exchange (black), we need a classification method to provide
information on the remaining curves (grey). The problem of
classification is mainly focused on them.</p>
<p><em>Future plans: the classification of the subfragments of the
overlapping peptides.</em></p>
<div class="section level3">
<h3 id="obtaining-the-uptake-curve">Obtaining the uptake curve<a class="anchor" aria-label="anchor" href="#obtaining-the-uptake-curve"></a>
</h3>
<p>The experimental data from the csv file is processed and
aggregated.<br>
Firstly, the deuterium uptake curve is prepared. It is a function of
deuterium uptake in time, with values defined as:</p>
<p><span class="math display">\[
    D_t = m_t - m_0
\]</span></p>
<p>where <span class="math inline">\(D_t\)</span> is deuterium uptake in
time <span class="math inline">\(t\)</span> in daltons, <span class="math inline">\(m_t\)</span> is mass of the peptide measured in
time <span class="math inline">\(t\)</span> and <span class="math inline">\(m_0\)</span> is mass of undeuterated peptide.</p>
<p>Then, the uptake curve is normalized. The values are scaled according
to the assumption, that the last time point of measurement or supplied
fully deuterated control (difference explained below) is the maximal
experimental deuterium uptake with 100% deuterium uptake. This can be
calculated in two ways:</p>
<p><span class="math display">\[
    D_{t, sc} = \frac{D_t}{D_{100}} = \frac{m_t - m_0}{m_{100} - m_0}
\]</span></p>
<p>This form of the uptake curve is used for the fitting process.
Because of this, we can operate using percentages for populations
(denoted as <span class="math inline">\(n_i\)</span>, the fraction of
exchangeable hydrogens) undergoing different exchange patterns, and
disregard the back-exchange problem for a while.</p>
<p><em>Comment on the difference between treating the last time point of
measurement as fully deuterated (FD) control and additionally prepared
fully deuteration control. When the first option is chosen, the last
time point of measurement measuremnt ia assigned the value of 100% of
deuterium uptake and the measurement point is taking part in the fitting
process. When the additional fully deuterated control is chosen, all the
measurement values are scaled with respect to that, but this FD value is
not assigned to any time point, and not taking part in the fitting
process, only the real measurement time points.</em></p>
</div>
<div class="section level3">
<h3 id="extreme-case-recognition">Extreme case recognition<a class="anchor" aria-label="anchor" href="#extreme-case-recognition"></a>
</h3>
<p>Firstly, we recognize extreme cases of uptake curve, and assigned
them a class name without fitting process.</p>
<p>For the peptide to be labeled as <strong>none exchange</strong>, has
to fulfill defined requirements:</p>
<ul>
<li>the uptake level [Da] in the last time point of measurement (<span class="math inline">\(D_{100}\)</span>) is lower than 1 Da,</li>
<li>the thoretical deuterium uptake in the last time point of
measurement (scaled with respect to maximal possible uptake calculated
from the sequence) is lower than 10%.</li>
</ul>
<p>We interpret this case as a lack of observable exchange during the
course of experiment, and indicate it with the black color on the
visualization.</p>
<p>For the peptide to be disqualified from the fitting process and
labeled by <strong>invalid</strong> there has to be lack of sufficient
number of time points. It is crucial for the peptide to have valid
measurements for <span class="math inline">\(t_0\)</span> and <span class="math inline">\(t_100\)</span>, as otherwise it prevents the
normalization of values and causes the falsyfication of data. The
missing of one or two time points of measurement (apart from controls)
causes the use of two- or one- component model, but does not prevent the
fitting process.</p>
<p>The fitting process is not conducted for uptake curves classified as
extreme cases (no exchange or invalid).</p>
</div>
<div class="section level3">
<h3 id="exchange-class-definition">Exchange class definition<a class="anchor" aria-label="anchor" href="#exchange-class-definition"></a>
</h3>
<p>Following the literature - especially in a cornerstone of the studies
on the modeling hydrogen-deuterium exchange, the pioneering article of
Zhang and Smith , we expect the process of deuterium exchange for the
peptide to be described as a three-component equation <em>x</em>}:</p>
<p><span class="math display">\[
D = n_1 \cdot (1 - exp(-k_1 \cdot t)) + n_2 \cdot (1-exp(-k_2 \cdot t))
+ n_3 \cdot (1 - exp(-k_3 \cdot t))
\]</span> where <span class="math inline">\(n_i\)</span> indicates the
population of i-th group and <span class="math inline">\(k_i\)</span> is
the exchange rate of i-th group. Moreover, we assume:</p>
<ul>
<li>
<span class="math inline">\(n_1\)</span>, <span class="math inline">\(k_1\)</span> - fast exchange (red)</li>
<li>
<span class="math inline">\(n_2\)</span>, <span class="math inline">\(k_2\)</span> - medium exchange (green)</li>
<li>
<span class="math inline">\(n_3\)</span>, <span class="math inline">\(k_3\)</span> - slow exchange (blue)</li>
</ul>
<p>Ideally, <span class="math inline">\(n_1 + n_2 + n_3 = 1\)</span>. In
this equation, we have six unknown parameters that need to be found.</p>
<p>Unfortunately, the authors of this paper did not provide boundaries
for each exchange group. The ranges proposed by us, according to our
experience, can be found in table <em>x</em>.</p>
<p>The ranges of exchange rates can be changed if desired. However, we
recommend avoiding situations where a certain range is covered by two
classes, as it may lead to misclassification.</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th>lower</th>
<th>upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(k_1\)</span></td>
<td>1</td>
<td>30</td>
</tr>
<tr class="even">
<td><span class="math inline">\(k_2\)</span></td>
<td>0.1</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(k_3\)</span></td>
<td>0</td>
<td>0.1</td>
</tr>
</tbody>
</table>
<p>The Zhang &amp; Smith equation describes a theoretical situation,
which may not occur during every experiment. Thus, we prepared different
workflows and modifications (described later on), but the
three-component equation is our desired starting point.</p>
</div>
<div class="section level3">
<h3 id="workflow-selection">Workflow selection<a class="anchor" aria-label="anchor" href="#workflow-selection"></a>
</h3>
<p>We have multiple workflows prepared. We strongly advise using the
first one, but we understand the specificity of each experiment and we
leave the final decision to the user, trusting their motives.</p>
<p>Available workflows:</p>
<ul>
<li>3exp/1exp - we start the fitting process by looking for the best fit
using function <em>x</em> with ranges specified in table <em>x</em>}.
For the peptides with unsatisfactory results, we look for only one
component function (described below). The selection of better results is
made by comparing the <span class="math inline">\(R^2\)</span>
values.</li>
<li>2exp/1exp - the starting point is the two-component function
(described below), and then the one-component function. The decision
process is the same as in the previous point.</li>
<li>3exp/2exp/1exp - all of the variants of the fitting process are
prepared and the best is chosen based on the <span class="math inline">\(BIC\)</span> value.</li>
</ul>
<div class="section level4">
<h4 id="exp-fit">3exp fit<a class="anchor" aria-label="anchor" href="#exp-fit"></a>
</h4>
<p>The fitting function is described as Zhang &amp; Smith equation
<em>x</em>, with initial values:</p>
<ul>
<li><span class="math inline">\(n_1 = n_2 = n_3 = 0.33\)</span></li>
<li><span class="math inline">\(k_1 = 1\)</span></li>
<li><span class="math inline">\(k_2 = 0.1\)</span></li>
<li><span class="math inline">\(k_3 = 0.01\)</span></li>
</ul>
<p>The boundaries for the values are as described in table
<em>x</em>.</p>
<p>The number of unknown parameters is 6.</p>
</div>
<div class="section level4">
<h4 id="exp-fit-1">2exp fit<a class="anchor" aria-label="anchor" href="#exp-fit-1"></a>
</h4>
<p>The two-component fitting function, is described as follows:</p>
<p><span class="math display">\[
D = n_a \cdot (1 - exp(-k_a \cdot t)) + n_b \cdot (1-exp(-k_b \cdot t))
\]</span></p>
<p>Where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are two of three exchange groups
defined for the Zhang &amp; Smith equation. We perform three fitting
processes (for each group combination) and select the best result
comparing the <span class="math inline">\(R^2\)</span> value. That means
we look for the fit using <span class="math inline">\(k_1\)</span> with
<span class="math inline">\(k_2\)</span>, <span class="math inline">\(k_2\)</span> with <span class="math inline">\(k_3\)</span>, or <span class="math inline">\(k_1\)</span> with <span class="math inline">\(k_3\)</span> and select one as the answer.</p>
<p>The initial value for <span class="math inline">\(n_a\)</span> and
<span class="math inline">\(n_b\)</span> is 0.5. The initial values for
<span class="math inline">\(k\)</span> are the same with analogical
cases from the three-component equation (see section <em>x</em>).</p>
<p>In this case, we assume that <span class="math inline">\(n_a\)</span>
of hydrogen particles are undergoing the exchange with <span class="math inline">\(k_a\)</span> exchange rate, an <span class="math inline">\(n_b\)</span> with exchange rate <span class="math inline">\(k_b\)</span>.</p>
<p>The number of unknown parameters is 4.</p>
</div>
<div class="section level4">
<h4 id="exp-fit-2">1exp fit<a class="anchor" aria-label="anchor" href="#exp-fit-2"></a>
</h4>
<p>The fitting function is described as follows:</p>
<p><span class="math display">\[
D = n \cdot (1 - exp(-k \cdot t))  
\]</span></p>
<p>In this case, we assume that all of the hydrogen particles in the
peptide are undergoing the exchange in a similar way. Ideally with <span class="math inline">\(n \sim 1\)</span>.</p>
<p>The initial values for the fit:</p>
<ul>
<li><span class="math inline">\(n = 1\)</span></li>
<li><span class="math inline">\(k = 1\)</span></li>
<li>upper boundary of <span class="math inline">\(k\)</span> = upper
boundary of <span class="math inline">\(k_1\)</span>
</li>
<li>lower boundary of <span class="math inline">\(k\)</span> = lower
boundary of <span class="math inline">\(k_3\)</span>
</li>
</ul>
<p>The number of unknown parameters is 2.</p>
</div>
<div class="section level4">
<h4 id="fitting-parameters">Fitting parameters<a class="anchor" aria-label="anchor" href="#fitting-parameters"></a>
</h4>
<p>To fit the curve we use the nonlinear least square method. For more
information, see the documentation of the used <a href="https://rdocumentation.org/packages/minpack.lm/versions/1.2-3" class="external-link">R
package</a>.</p>
<p>Recommended parameters (possible change):</p>
<ul>
<li>max iteration: 100,</li>
<li>algorithm: Levenberg-Marquardt.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="results-of-the-fitting-process">Results of the fitting process<a class="anchor" aria-label="anchor" href="#results-of-the-fitting-process"></a>
</h3>
<p>TODO: n, k, rgb, interpretation</p>
</div>
<div class="section level3">
<h3 id="calculation-of-estimed-exchange-rate-k">Calculation of estimed exchange rate k<a class="anchor" aria-label="anchor" href="#calculation-of-estimed-exchange-rate-k"></a>
</h3>
<p>As we are working on normalized values and each value <span class="math inline">\(n_i\)</span> is within the limits of (0, 1), whe
can treat them somehow as a probability of getting <span class="math inline">\(k_i\)</span>. Then, we can caluclate the estimate
k value, aggrgating all of the fit parameters into one value:</p>
<p><span class="math display">\[
k_{exp} = \sum^i n_i \cdot k_i
\]</span></p>
</div>
<div class="section level3">
<h3 id="high-resolution-results">High resolution results<a class="anchor" aria-label="anchor" href="#high-resolution-results"></a>
</h3>
<p>As the classification is performed on uptake curves of each peptide,
there is a need of aggrgation to obtain the high resolution results.
Currently, HRaDeX allows the use of two methods.</p>
<div class="section level4">
<h4 id="selection-of-the-shortest-peptide-">Selection of the shortest peptide.<a class="anchor" aria-label="anchor" href="#selection-of-the-shortest-peptide-"></a>
</h4>
<p>For each residue there is a subset of peptides covering said residue.
From this set, the shortest peptide is chosen as a determinant for the
resiude, as the most represantative.</p>
</div>
<div class="section level4">
<h4 id="aggregation-of-values">Aggregation of values<a class="anchor" aria-label="anchor" href="#aggregation-of-values"></a>
</h4>
<p>Aggregation of values is inspired by the article by Keppler and Weis
(doi: 10.1007/s13361-014-1033-6), with small changes: the ommition of
the first residue is done in different step if demanded by the user. The
aggregation of values is done on a subset of already filtered data.</p>
<p>For each residue there is a subset of peptides covering said residue.
Then, the final <span class="math inline">\(n_{i, agg}\)</span> is
calculated from the subset of <span class="math inline">\(n_i\)</span>,
with weights inverse proportional to the max uptake of peptide (<span class="math inline">\(mu_i\)</span>) - the shortest the peptide the
highest the possibility that the uptake took place in said residue:</p>
<p><span class="math display">\[
w_i = \frac{\frac{1}{mu_i}}{\sum^i \frac{1}{mu_i}}
\]</span></p>
<p>Then, the <span class="math inline">\(n_i%\)</span> is a weighted
average of set of <span class="math inline">\(n_i\)</span>.</p>
<p><span class="math display">\[
n_{i, agg} = \frac{\sum^i w_i \cdot n_i}{\sum^i w_i}
\]</span> There is a possibility that <span class="math inline">\(n_{i,
agg}\)</span> obtained that way exceeds the limit of 1. Then, we
normalize the values, to get the sense of proportionality.</p>
<p><span class="math display">\[
n_{i, agg.scaled} = \frac{n_{i, agg}}{\sum^i n_{i, agg}}
\]</span></p>
<p>This way, we have the right values to obtain the RGB color value.</p>
<p>The estimated k values are calculated analogically.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="workflow-schema">Workflow schema<a class="anchor" aria-label="anchor" href="#workflow-schema"></a>
</h2>
<p>Figure <em>x</em> presents the diagram for classifying one peptide in
one biological state, based on its uptake curve. This process can be
repeated for each peptide from the data file to access the information
for the set of peptides from a protein.</p>
<div class="float">
<img src="figures/workflow_diagram.png" alt="Workflow schema"><div class="figcaption">Workflow schema</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weronika Puchala, Michal Burdukiewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
